# .github/workflows/firebase-deploy.yaml
# This workflow is typically generated by 'firebase init hosting:github'
# and is responsible for building and deploying your Next.js application
# to Firebase Hosting when changes are merged into the 'main' branch.

name: Deploy to Live Channel on Merge

# Controls when the workflow will run
on:
  push:
    branches:
      - main # This workflow triggers on pushes to the 'main' branch

# Permissions granted to the GITHUB_TOKEN for this workflow.
# 'contents: read' is generally sufficient for checking out code.
# The Firebase action itself uses the FIREBASE_SERVICE_ACCOUNT secret for deployment permissions.
permissions:
  contents: read

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest # Specifies the runner environment

    steps:
      # Step 1: Checkout the repository code
      # This action checks out your repository under $GITHUB_WORKSPACE,
      # so your workflow can access it.
      - name: Checkout code
        uses: actions/checkout@v4

      # Step 2: Set up Node.js environment
      # This ensures the correct Node.js version is available for the build.
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20' # Specify your Node.js version (e.g., '18', '20', or '22')

      # Step 3: Install dependencies and build the Next.js project
      # The 'npm ci' command is used for clean installs in CI environments.
      # 'npm run build' will create the optimized production build of your Next.js app.
      - name: Install dependencies and build project
        run: |
          npm ci # Installs dependencies cleanly, using package-lock.json
          npm run build # Builds the Next.js application for production

      # Step 4: Deploy to Firebase Hosting
      # This step uses the official Firebase Hosting GitHub Action.
      # It automatically detects your project configuration (firebase.json)
      # and deploys the built output.
      # The firebaseServiceAccount secret is provided securely by GitHub Actions.
      - name: Deploy to Firebase Hosting
        uses: FirebaseExtended/action-hosting-deploy@v0 # Using version 0 (latest stable)
        with:
          repoToken: '${{ secrets.GITHUB_TOKEN }}' # Automatically provided by GitHub for commenting on PRs
          firebaseServiceAccount: '${{ secrets.FIREBASE_SERVICE_ACCOUNT_YOUR_PROJECT_ID }}' # Your Firebase service account secret
          projectId: 'profit-462922' # Replace with your actual Firebase Project ID
          channelId: 'live' # Deploys to the default live hosting channel
          # target: 'your-hosting-target' # Uncomment and replace if you have multiple hosting sites and need to target a specific one
          # entryPoint: './' # The directory containing your firebase.json, relative to repo root. Defaults to '.'

      # Optional: Add steps for deploying functions or other Firebase services if needed
      # - name: Deploy Firebase Functions (Example)
      #   run: firebase deploy --only functions
      #   env:
      #     FIREBASE_TOKEN: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_YOUR_PROJECT_ID }} # Use service account for auth
      #     PROJECT_ID: 'your-firebase-project-id'
